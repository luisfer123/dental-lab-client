<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3 gap-2">
    <div class="d-flex align-items-center gap-2">
      <h2 class="mb-0">Clientes</h2>

      <!-- Filtro por perfil -->
      <select
        class="form-select form-select-sm w-auto"
        [(ngModel)]="selectedFilter"
        (change)="onFilterChange(selectedFilter)"
      >
        <option value="all">Todos</option>
        <option value="dentists">Dentistas</option>
        <option value="students">Estudiantes</option>
        <option value="technicians">Técnicos</option>
      </select>
    </div>

    <button class="btn btn-sm btn-success" routerLink="/clients/new">
      <i class="bi bi-plus-circle"></i> Agregar cliente
    </button>
  </div>

  <!-- Cargando -->
  <div *ngIf="loading" class="text-center py-5 text-muted">
    <div class="spinner-border" role="status"></div>
    <p class="mt-2">Cargando {{ selectedFilter }}...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger text-center">
    {{ error }}
  </div>

  <!-- Tabla -->
  <div *ngIf="!loading && !error && clients.length > 0">
    <table class="table table-hover align-middle shadow-sm">
      <thead class="table-light">
        <tr>
          <th scope="col" style="width: 60px;">#</th>
          <th scope="col">Nombre</th>
          <th scope="col">Correo electrónico</th>
          <th scope="col">Teléfono</th>
          <th scope="col" class="text-center" style="width: 120px;">Estado</th>
          <th scope="col" class="text-end" style="width: 120px;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of clients; let i = index">
          <th scope="row">{{ i + 1 + page * size }}</th>
          <td>{{ c.displayName }}</td>
          <td>{{ c.primaryEmail || '—' }}</td>
          <td>{{ c.primaryPhone || '—' }}</td>
          <td class="text-center">
            <span class="badge" [ngClass]="c.active ? 'bg-success' : 'bg-secondary'">
              {{ c.active ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td class="text-end">
            <button class="btn btn-sm btn-outline-primary me-1" (click)="goToDetails(c.id)">
              <i class="bi bi-eye"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Información de página -->
    <p class="text-muted small text-center mb-3">
      Página {{ page + 1 }} de {{ totalPages }} — {{ totalElements }} 
      {{ selectedFilter === 'all' ? 'clientes en total' : selectedFilter }}
    </p>

    <!-- Paginación -->
    <nav *ngIf="totalPages > 1" class="d-flex justify-content-center">
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" [class.disabled]="page === 0">
          <a class="page-link" href="#" (click)="prevPage(); $event.preventDefault()">«</a>
        </li>

        <li
          class="page-item"
          *ngFor="let p of [].constructor(totalPages); let i = index"
          [class.active]="i === page"
        >
          <a class="page-link" href="#" (click)="goToPage(i); $event.preventDefault()">
            {{ i + 1 }}
          </a>
        </li>

        <li class="page-item" [class.disabled]="page + 1 >= totalPages">
          <a class="page-link" href="#" (click)="nextPage(); $event.preventDefault()">»</a>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Vacío -->
  <div *ngIf="!loading && !error && clients.length === 0" class="text-center text-muted py-5">
    No se encontraron {{ selectedFilter === 'all' ? 'clientes' : selectedFilter }}.
  </div>
</div>
