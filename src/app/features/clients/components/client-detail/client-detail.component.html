<div class="container mt-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">Detalles del cliente</h2>
    <button class="btn btn-outline-secondary btn-sm" (click)="goBack()">
      <i class="bi bi-arrow-left"></i> Volver a la lista
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5 text-muted">
    <div class="spinner-border" role="status"></div>
    <p class="mt-2">Cargando información...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger text-center">
    {{ error }}
  </div>

  <!-- Client Info -->
  <div *ngIf="!loading && !error && client" class="card shadow-sm mb-4">
    <div class="card-body">
      <h4 class="card-title mb-3">{{ client.displayName }}</h4>
      <div class="row">
        <div class="col-md-6">
          <p><strong>Nombre:</strong> {{ client.firstName }} {{ client.secondName || '' }}</p>
          <p><strong>Apellidos:</strong> {{ client.lastName }} {{ client.secondLastName || '' }}</p>
        </div>
        <div class="col-md-6">
          <p><strong>Correo electrónico:</strong> {{ client.primaryEmail || '—' }}</p>
          <p><strong>Teléfono:</strong> {{ client.primaryPhone || '—' }}</p>
        </div>
      </div>
      <p><strong>Dirección principal:</strong> {{ client.primaryAddress || '—' }}</p>
      <p>
        <strong>Estado:</strong>
        <span class="badge" [ngClass]="client.active ? 'bg-success' : 'bg-secondary'">
          {{ client.active ? 'Activo' : 'Inactivo' }}
        </span>
      </p>
    </div>
  </div>

  <!-- Profiles -->
  <div *ngIf="client?.profiles?.length">
    <h5 class="mb-3">Perfiles asociados</h5>

    <div *ngFor="let profile of client?.profiles ?? []" class="card shadow-sm mb-3">
      <div class="card-body">
        <h6 class="card-title">
          <i *ngIf="profile.type === 'DENTIST'" class="bi bi-heart-pulse text-primary me-2"></i>
          <i *ngIf="profile.type === 'STUDENT'" class="bi bi-mortarboard text-success me-2"></i>
          <i *ngIf="profile.type === 'TECHNICIAN'" class="bi bi-gear text-warning me-2"></i>
          {{ profile.type === 'DENTIST' ? 'Dentista' :
             profile.type === 'STUDENT' ? 'Estudiante' :
             profile.type === 'TECHNICIAN' ? 'Técnico' : 'Otro' }}
        </h6>

        <ng-container *ngIf="isDentist(profile)">
          <p><strong>Clínica:</strong> {{ profile.clinicName || '—' }}</p>
        </ng-container>

        <ng-container *ngIf="isStudent(profile)">
          <p><strong>Universidad:</strong> {{ profile.universityName || '—' }}</p>
          <p><strong>Semestre:</strong> {{ profile.semester || '—' }}</p>
        </ng-container>

        <ng-container *ngIf="isTechnician(profile)">
          <p><strong>Laboratorio:</strong> {{ profile.labName || '—' }}</p>
          <p><strong>Especialidad:</strong> {{ profile.specialization || '—' }}</p>
        </ng-container>

        <p class="text-muted small mt-2">
          Creado el {{ profile.createdAt | date:'short' }}
        </p>
      </div>
    </div>
  </div>

  <!-- No profiles -->
  <div *ngIf="!loading && client && (!client.profiles || client.profiles.length === 0)"
       class="alert alert-light border text-center text-muted">
    Este cliente no tiene perfiles asociados.
  </div>

  <!-- Delete button (bottom right) -->
<div *ngIf="!loading && !error && client" class="d-flex justify-content-end mt-4 mb-5">
  <button class="btn btn-danger px-4" (click)="openConfirmModal()">
    <i class="bi bi-trash"></i> Eliminar cliente
  </button>
</div>

<!-- Bootstrap Modal -->
<div class="modal fade" #confirmModal tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="confirmModalLabel">
          Confirmar eliminación
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"
          (click)="closeConfirmModal()"></button>
      </div>

      <div class="modal-body">
        <p>
          ¿Estás seguro de que deseas eliminar al cliente
          <strong>{{ client?.displayName }}</strong>?
        </p>
        <p class="mb-0 text-muted small">Esta acción no se puede deshacer.</p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeConfirmModal()">Cancelar</button>
        <button type="button" class="btn btn-danger" (click)="deleteClient()" [disabled]="deleting">
          {{ deleting ? 'Eliminando...' : 'Eliminar' }}
        </button>
      </div>
    </div>
  </div>
</div>
</div>
